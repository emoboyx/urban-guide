if (self.CavalryLogger) { CavalryLogger.start_js(["4k9Z1"]); }

__d("MqttProtocolCodec",["MqttProtocolUtils","sprintf"],(function(a,b,c,d,e,f){__p&&__p();var g=b("MqttProtocolUtils").UTF8Length,h=b("MqttProtocolUtils").encodeMBI,i=b("MqttProtocolUtils").parseUTF8,j=b("MqttProtocolUtils").readUint16,k=b("MqttProtocolUtils").stringToUTF8,l=b("MqttProtocolUtils").writeString,m=b("MqttProtocolUtils").writeUint16,n=Object.freeze({CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14}),o=[0,6,77,81,73,115,100,112,3];function p(a,c){__p&&__p();c=c;var d=c,e=a[c],f=e>>4;c+=1;var g,h=0,k=1;do{if(c==a.length)return{wireMessage:null,position:d};g=a[c++];h+=(g&127)*k;k*=128}while((g&128)!==0);g=c+h;if(g>a.length)return{wireMessage:null,position:d};var l;switch(f){case n.CONNACK:k=a[c++];h=!!(k&1);d=a[c++];l=new s(h,d);break;case n.PUBLISH:k=e&15;h=k>>1&3;d=j(a,c);c+=2;e=i(a,c,d);c+=d;d=null;h===1&&(d=j(a,c),c+=2);var m=w.createWithBytes(a.subarray(c,g)),o=(k&1)===1;k=(k&8)===8;l=new x(e,m,h,d,o,k);break;case n.PINGRESP:l=new q("PINGRESP");break;case n.PUBACK:case n.UNSUBACK:e=j(a,c);l=new t(f===n.PUBACK?"PUBACK":"UNSUBACK",e);break;case n.SUBACK:m=j(a,c);c+=2;h=a.subarray(c,g);l=new r(m,h);break;default:throw new Error(b("sprintf")("AMQJS0016E Invalid MQTT message type %s.",f))}return{wireMessage:l,position:g}}function a(a){__p&&__p();a=new Uint8Array(a);var b=[],c=0;while(c<a.length){var d=p(a,c),e=d[0];c=d[1];if(e!==null)b.push(e);else break}return b}function c(a){__p&&__p();a=new Uint8Array(a);var b=[];if(this._receiveBuffer!=null){var c=this._receiveBuffer.length,d=new Uint8Array(this._receiveBuffer.length+a.length);d.set(this._receiveBuffer);d.set(a,c);a=d;delete this._receiveBuffer}c=0;while(c<a.length){d=p(a,c);var e=d.wireMessage;c=d.position;if(e!=null)b.push(e);else break}c<a.length&&(this._receiveBuffer=a.subarray(c));return b}d=function(){"use strict";function a(a){this.messageType=n[a]}var b=a.prototype;b.encode=function(){throw new TypeError("Cannot abstract class WireMessage")};return a}();var q=function(b){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,b);function a(a){return b.call(this,a)||this}var c=a.prototype;c.encode=function(){var a=new ArrayBuffer(2),b=new Uint8Array(a);b[0]=(this.messageType&15)<<4;return a};return a}(d);f=function(a){"use strict";__p&&__p();babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,"DISCONNECT")||this}var c=b.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=new ArrayBuffer(2),c=new Uint8Array(b);c[0]=a;c.set(h(0),1);return b};return b}(d);var r=function(b){"use strict";babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"SUBACK")||this;d.messageIdentifier=a;d.returnCode=c;return d}return a}(d),s=function(b){"use strict";babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"CONNACK")||this;d.sessionPresent=a;d.returnCode=c;return d}return a}(d),t=function(b){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.messageIdentifier=c;return a}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=2,c=h(b),d=c.length+1;b=new ArrayBuffer(b+d);var e=new Uint8Array(b);e[0]=a;e.set(c,1);d=m(this.messageIdentifier,e,d);return b};return a}(d),u=function(b){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"CONNECT")||this;d.clientId=a;d.connectOptions=c;return d}var c=a.prototype;c.encode=function(){__p&&__p();var a=(this.messageType&15)<<4,b=o.length+3;b+=g(this.clientId)+2;b+=g(this.connectOptions.userName)+2;var c=h(b);b=new ArrayBuffer(1+c.length+b);var d=new Uint8Array(b);d[0]=a;a=1;d.set(c,1);a+=c.length;d.set(o,a);a+=o.length;c=2|128;d[a++]=c;a=m(this.connectOptions.keepAliveInterval,d,a);a=l(this.clientId,g(this.clientId),d,a);a=l(this.connectOptions.userName,g(this.connectOptions.userName),d,a);return b};return a}(d),v=function(c){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,c);function a(a,d,e,f){var g;g=c.call(this,a)||this;g.topic=d;if(e<0&&e>1||e===1&&f==null)throw new TypeError(b("sprintf")("Invalid argument %s for %s.","qos: "+e,"messageType: "+a));g.qos=e;g.messageIdentifier=f;return g}var d=a.prototype;d.encode=function(){__p&&__p();var a=(this.messageType&15)<<4;a|=2;var b=g(this.topic),c=2+b+2;this.messageType===n.SUBSCRIBE&&(c+=1);var d=h(c);c=new ArrayBuffer(1+d.length+c);var e=new Uint8Array(c);e[0]=a;a=1;e.set(d,1);a+=d.length;this.messageIdentifier!=null&&(a=m(this.messageIdentifier,e,a));a=l(this.topic,b,e,a);this.messageType===n.SUBSCRIBE&&this.qos!=null&&(e[a++]=this.qos);return c};return a}(d),w=function(){"use strict";__p&&__p();function a(a,b){this.payloadString=a,this.payloadBytes=b}a.createWithString=function(b){var c=new ArrayBuffer(g(b));c=new Uint8Array(c);c=k(b,c,0);return new a(b,c)};a.createWithBytes=function(b){var c=i(b,0,b.length);return new a(c,b)};var b=a.prototype;b.string=function(){return this.payloadString};b.bytes=function(){return this.payloadBytes};return a}(),x=function(c){"use strict";__p&&__p();babelHelpers.inheritsLoose(a,c);function a(a,d,e,f,g,h){__p&&__p();var i;i=c.call(this,"PUBLISH")||this;i.topic=a;i.payloadMessage=d;i.qos=e;i.messageIdentifier=f;i.retained=g!=null?g:!1;i.duplicate=h!=null?h:!1;if(i.qos===1&&i.messageIdentifier==null)throw new TypeError(b("sprintf")("AMQJS0013E Invalid argument %s for %s.","qos: 1","messageIdentifier: null | Publish"));return i}var d=a.prototype;d.encode=function(){__p&&__p();var a=(this.messageType&15)<<4;this.duplicate&&(a|=8);a=a|=this.qos<<1;this.retained&&a!=1;var b=g(this.topic),c=b+2;c+=this.messageIdentifier==null?0:2;var d=this.payloadMessage.bytes();c+=d.byteLength;var e=h(c);c=new ArrayBuffer(1+e.length+c);var f=new Uint8Array(c);f[0]=a;f.set(e,1);a=1+e.length;a=l(this.topic,b,f,a);this.messageIdentifier!=null&&(a=m(this.messageIdentifier,f,a));f.set(d,a);return c};return a}(d);e.exports={MESSAGE_TYPE:n,WireMessage:{Base:d,PubAckUnsubAck:t,Ping:q,ConnAck:s,Connect:u,Disconnect:f,Subscription:v,Publish:x},createMessageWithString:w.createWithString,decodeMessage:p,decodeMessages:a,deframeMessages:c}}),null);